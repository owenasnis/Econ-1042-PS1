---
title: "Econ 1042 PS1"
author: "Owen Asnis"
date: "2023-02-01"
output: pdf_document
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(estimatr)
library(sandwich)
library(lmtest)

```

# Data Wrangling 

```{r data wrangling, message=FALSE}

kickers <- read_csv("kickers_v2.csv",
                    show_col_types = FALSE) %>%
  rename(., "ID" = "...1") %>%
  mutate(Grass = if_else(Grass == TRUE, 1, 0))

```

# Question 1

### a.)
```{r Q1a}

min <- min(kickers$Distance)
max <- max(kickers$Distance)
mean <- round(mean(kickers$Distance), 
              digits = 3)
median <- median(kickers$Distance)

sprintf("Minimum distance: %s yards.", min)
sprintf("Maximum distance: %s yards.", max)
sprintf("Mean distance: %s yards", mean)
sprintf("Median distance: %s yards", median)

```

### b.) The minimum distance (18 yards) isn't lower for two reasons: First, the kicker must kick the ball through the end zone (accounting for 10 yards) in addition to the distance from the ball to the goal line, and second the ball is snapped a distance of 7 yards to the holder, who holds the ball for the kicker. Therefore, an 18 yard field goal actually begins at the 1 yard line, but the total distance of the kick is 10 yards (the end zone) + 7 yards (the snap) + 1 yard (the distance to the goal line) = 18 yards. 

### c.)
```{r Q1c}

max_distance_kick <- kickers %>% 
  filter(Distance == max(Distance))

print(max_distance_kick)

```
### The special circumstance that explains the maximum is that it occured in the 30th minute of the game, the last minute of the 2nd quarter before halftime. Therefore, in this instance, the Oakland Raiders were forced to try to score, because the half was ending and possession is assigned based on the result of the coin toss after the 2nd quarter, and decided they had a better chance of scoring on a very long field goal rather than a hail mary. 

# Question 2

```{r Q2}

forty_to_fortyfive <- kickers %>%
  filter(Distance %in% (40:45))

forty_to_fortyfive_success <- round((mean(forty_to_fortyfive$Success) * 100), 
                                    digits = 3)

over_fortyfive <- kickers %>% 
  filter(Distance > 45)

over_fortyfive_success <- round((mean(over_fortyfive$Success) * 100), 
                            digits = 3)

sprintf("Kicks from 40 to 45 yards made: %s percent", forty_to_fortyfive_success)
sprintf("Kicks over 45 yards made: %s percent", over_fortyfive_success)

```

# Question 3

```{r Q3p1}

grass_only <- kickers %>% 
  filter(Grass == 1)

make_rate_grass <- round((mean(grass_only$Success) * 100), 
                         digits = 3)

turf_only <- kickers %>% 
  filter(Grass == 0)

make_rate_turf <- round((mean(turf_only$Success) * 100), 
                        digits = 3)

sprintf("Make rate on grass: %s percent", make_rate_grass)
sprintf("Make rate on turf: %s percent", make_rate_turf)

```
### The make rate was slightly higher on turf. 

```{r Q3p2}

# Source: "Dealing with heteroskedasticity; regression with robust standard 
# errors using R" by Bruno Rodrigues

m1 <- lm(Success ~ Grass, data = kickers)
coeftest(m1, vcov = vcovHC(m1))

```
### The difference is statistically significant at the 0.001 level. It could be the true effect of surface, because turf is consistantly a smoother and more solid surface, whereas grass is more imperfect with divits and inconsistencies. Therefore, in some ways, it seems like turf provides better conditions for kickers. However, there are clear counterarguments, including that grass might be better in rainy and snowy conditions, because it would be less slippery than turf.

# Question 4 

### a.)
```{r Q4a}

distance_surface_correlation <- round(cor(kickers$Distance, kickers$Grass), 
                                       digits = 3)

sprintf("Correlation between distance and surface: %s",
        distance_surface_correlation)

```
### Coaches might be more reluctant to attempt longer kicks on grass because of its imperfect texture and also potentially because many grass fields are outdoors where wind conditions can drastically influence kicking whereas many turf fields are indoors where these conditions aren't a factor.  

### b.)
```{r Q4b}

distance_makepc_correlation <- round(cor(kickers$Distance, kickers$Success), 
                                     digits = 3)

sprintf("Correlation between distance and make percentage: %s",
        distance_makepc_correlation)

```

# Question 5 

```{r Q5}

# short-form(coefficient) = long-form(coefficient) + (omitted variable coefficient)(correlation)

lm2 <- lm_robust(Success ~ Grass + Distance, data = kickers)
summary(lm2)

# becomes more negative (adding distance is omitted variable bias)

```

# Question 6

```{r Q6}

lm3 <- lm_robust(Success ~ Distance + Grass + ScoreDiff + GameMinute, 
                 data = kickers)
summary(lm3)

lm4 <- lm_robust(Success ~ Distance + Grass + ScoreDiff + GameMinute + Kicker, 
                 data = kickers)
summary(lm4)

# Accounts for the skill of the kicker 

```

# Question 7 

```{r Q7}

new_data <- kickers %>%
  filter(Kicker == "Tucker", 
         ScoreDiff == -11, 
         Year == 2015, 
         GameMinute == 30)

predict(lm4, newdata = new_data) * 100

# estimate - Tucker coefficient 

```
